﻿<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width"/>
<title>공연정보</title>

<link rel='stylesheet' href='../../node_modules/bootstrap/dist/css/bootstrap.min.css'>
<link rel='stylesheet' href='../../css/style1.css'>

<!-- 댓글 관련 -->
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->


<style>
body * {
  box-sizing: border-box;
}



.imglist {
  border-radius: 50%;
  height: 60px;
  width: 60px;
}

span{margin: 20px;}
.w3-third{width:400px;}
.w3-twothird{width:400px;}
#detail-td1{width:100px;}
#detail-td1{width:100px;}

/* 
@media (max-width: 1000px) {
  .w3-third{width:300px;}
  .w3-twothird{width:500px;}
#detail-td1{width:100px;}
#detail-td1{width:100px;} 
*/
}
  /* #detail-td2{width:900px;} */
  /* html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif} */
</style>

<style>
.css3-tab {
  list-style: none;
  margin: 0 auto 40px;
  padding: 38px 0 0 0;
  position: relative;
  width: 90%;
}
.css3-tab input[type='radio'] {
  display: none;
}
.css3-tab .css3-tab-nav {
  display: table;
  table-layout: fixed;
  width: 100%;
}
.css3-tab .css3-tab-nav label {
  display: table-cell;
  background-color: #2b686e;
  color: #FFFFFF;
  padding: 15px;
  text-align: center;
  transition: all .3s ease 0s;
}
.css3-tab .css3-tab-nav label:hover {
  cursor: pointer;
  background: #edf7f8;
  color: #666666;
  transition: all .3s ease 0s;
}
@media (max-width: 1000px) {
  .css3-tab .css3-tab-nav {
    display: block;
    margin: 0 0 20px;
  }
  .css3-tab .css3-tab-nav label {
    display: block;
    box-sizing: border-box;
    width: 100%;
    padding: 20px;
  }
  .css3-tab input[id='tabOne']:checked ~ div.tab-one {
    border-top: solid 3px white;
    border-bottom: solid 1px black;
    border-right: solid 1px black;
    border-left: solid 1px black;
  }
  .css3-tab input[id='tabTwo']:checked ~ div.tab-two {
    border-top: solid 3px white;
    border-bottom: solid 1px black;
    border-right: solid 1px black;
    border-left: solid 1px black;
  }
  .css3-tab input[id='tabThree']:checked ~ div.tab-three {
    border-top: solid 3px white;
    border-bottom: solid 1px black;
    border-right: solid 1px black;
    border-left: solid 1px black;
  }
  .css3-tab input[id='tabFour']:checked ~ div.tab-four {
    border-top: solid 3px white;
    border-bottom: solid 1px black;
    border-right: solid 1px black;
    border-left: solid 1px black;
  }
}
.css3-tab .css3-tab-content {
  overflow: hidden;
  padding: 25px;
  display: none;
  background: #FFF;
  clear: left;
  box-sizing: border-box;
}
.css3-tab input[id='tabOne']:checked ~ .css3-tab-nav label[for='tabOne'] {
  background: red;
  color: white;
  cursor: default;
}
.css3-tab input[id='tabOne']:checked ~ div.tab-one {
  display: block;
  border-top: solid 3px red;
  border-bottom: solid 1px black;
  border-right: solid 1px black;
  border-left: solid 1px black;
}
.css3-tab input[id='tabTwo']:checked ~ .css3-tab-nav label[for='tabTwo'] {
  background: red;
  color: white;
  cursor: default;
}
.css3-tab input[id='tabTwo']:checked ~ div.tab-two {
  display: block;
  border-top: solid 3px red;
  border-bottom: solid 1px black;
  border-right: solid 1px black;
  border-left: solid 1px black;
}
.css3-tab input[id='tabThree']:checked ~ .css3-tab-nav label[for='tabThree'] {
  background: red;
  color: white;
  cursor: default;
}
.css3-tab input[id='tabThree']:checked ~ div.tab-three {
  display: block;
  border-top: solid 3px red;
  border-bottom: solid 1px black;
  border-right: solid 1px black;
  border-left: solid 1px black;
}
.css3-tab input[id='tabFour']:checked ~ .css3-tab-nav label[for='tabFour'] {
  background: red;
  color: white;
  cursor: default;
}
.css3-tab input[id='tabFour']:checked ~ div.tab-four {
  display: block;
  border-top: solid 3px red;
  border-bottom: solid 1px black;
  border-right: solid 1px black;
  border-left: solid 1px black;
}

</style>



</head>
<body>
<div class='container'>
<header></header>

<h1></h1>



<div class='w3-first my-hidden'>
<label for='no' class='col-sm-2 col-form-label'>공연번호</label>
<div class='col-sm-10'>
<input class='form-control' readonly id='no' type='number' name='no' value='0'>
</div>
</div>

<!-- 
<div id='general-view'>

   <div class="w3-panel">
    <div class="w3-row-padding">  style="margin:0 -16px">
      <div class="w3-third" style='border: 1px solid black'>
        <h5>관련 영상</h5>
            <div style='border: 1px solid black'>
            <img class="img" src="../download/no_img.jpg" style="width:400px">
                <iframe class="embed-responsive-item" id="video" src="https://www.youtube.com/embed/zpOULjyy-n8?rel=0" ></iframe>
            </div>
      </div>
      <div class="w3-third" style='border: 1px solid black'>
        <h5>상세 정보</h5>
        <table id="detail-table" class="w3-table w3-striped w3-white"></table>
      </div>
    </div>
  </div>

</div> 
-->

<div class='form-group row'>
    <div class='css3-tab'>
        <div class="w3-third">
          <h5>공연 미디어</h5>
            <table id="media-table" class="w3-table w3-striped w3-white"></table>
            <!-- <img class="img" src="../download/no_img.jpg" style="width:400px"> -->
        </div>
        <div class="w3-twothird">
          <h5>상세 정보</h5>
            <table id="detail-table" class="w3-table w3-striped w3-white"></table>
            <div class='col-sm-10'>
            <br>
            <button id="updateBtn" type="button" class='btn btn-primary btn-sm my-view'>공연 수정</button>
            <button id="deleteBtn" type="button" class='btn btn-primary btn-sm my-view'>공연 삭제</button>
            </div>
        </div>
    </div>


    <!-- Pure CSS Menu -->
        
    <div class='css3-tab'>
        <input type='radio' name='a' id='tabOne' tabindex="1" checked>
        <input type='radio' name='a' id='tabTwo' tabindex="2">
        <input type='radio' name='a' id='tabThree' tabindex="3">
        <input type='radio' name='a' id='tabFour' tabindex="4">
        <div class="css3-tab-nav">
            <label for='tabOne'>상세보기</label>
            <label for='tabTwo'>아티스트</label>
            <label for='tabThree'>미디어</label>
            <label for='tabFour'>평점 & 댓글</label>
        </div>
    
        <div class='css3-tab-content tab-one'>
            <div class='w3-third' style='border: 2px solid white'> 
                <div id='map_canvas' style='width:350px; height:300px; border: 2px solid white'></div>
            </div>
        
        </div>
        <div class='css3-tab-content tab-two'></div>
        <div class='css3-tab-content tab-three'></div>
        <div class='css3-tab-content tab-four'>
            
            
            <div id="comment" data-role="collapsible">
                
                <form id="formjjim">
                <div class='form-control' style="border:1px solid #eee; height:80px; padding-top:20px; background-color: #eee">
                    
                    <button id='jjimBtn' type="button" class='btn btn-primary btn-sm' style="width:80px;" name='jjim' >찜하기</button>
                    <!-- <button id='shareBtn' type="button" class='btn btn-primary btn-sm' name='share'>공유하기</button> -->
                    
                    <a id="kakao-link-btn" href="javascript:sendLink()">
                    <img src="//developers.kakao.com/assets/img/about/logos/kakaolink/kakaolink_btn_medium.png" style="width:40px; height:40px">
                    </a>
                    
                    <label for='rating' class='col-sm-2 col-form-label rating'></label>
                    <input class='col-sm-2 rating' type='number' min="-10" max="100" id='rating' name='rating' value=''>
                    <button id="ratingBtn" type="button" class='btn btn-primary btn-sm rating'>점수주기</button>
                    
                </div>
                </form>
                
                <h3>댓글</h3>
            
                <!-- <form id="comment_new_form" method="post" action="https://opentutorials.org/comment/add_ajax" data-ajax="true"> -->
                <form id="comment_new_form" >
                    <!-- <div class="profile_image">
                        <img src="/download/1518169411347_0.jpg"  height="50" alt="">
                    </div> -->
            
                    <div class="form_wrapper">
                        <dl class="comment_form_content">
                            <!-- <dt>댓글 본문</dt> -->
                            <dd>
                                <!-- <div id="reply_indicator">
                                    <a>리체님의 댓글에 대한 답글입니다.</a>
                                    <input type="hidden" name="parent" value="">
                                    <a class="btn btn_unchain" href="#">삭제</a>
                                </div> -->
                                <!-- <textarea name="cmt_content"></textarea> -->
                                <textarea class='form-control' id='ripple' name='ripple' rows='5' value=''></textarea>
                            </dd>
                        </dl>
                        <!-- <dl class="comment_form_writer">
                            <dt>작성자</dt>
                            <dd><input type="text" name="username" placeholder="이름"></dd>
                        </dl>
                        <dl class="comment_form_password">
                            <dt>비밀번호</dt>
                            <dd><input type="password" name="password" placeholder="비밀번호"></dd>
                        </dl> -->
                        <div class="buttons">
                            <!-- <input type="hidden" name="course_id" value="0">
                            <input type="hidden" name="module_id" value="1976">
                            <input type="hidden" name="topic_id" value="0"> -->
                            <button id="rippleBtn"type="button" class='btn btn-primary btn-sm' style="float:left">댓글달기</button>
            
                        </div>
                    </div>
                </form>
                <br><br>
                <ol id="comment_list"></ol>
            
                <!-- <div id="cmt_more" class="hidden">
                    <a href="#"><span>더 보기</span></a>
                </div> -->
            </div>
        
            <table id="ripplelist" class='table table-hover'>
            <thead>
            <tr>
            <!-- <th></th><th></th> -->
            </tr>
            </thead>
            <tbody></tbody>
            </table>
        
        </div>
    </div>
</div>


    <footer></footer>
</div>


<script src='../node_modules/jquery/dist/jquery.min.js'></script>
<script src='../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>

<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?region=KR&key=AIzaSyBl2qPIVMyVVmfA4F43i0cCk3g6vf2RRZI&callback=initMap"></script>




<script type='text/javascript'>
  //<![CDATA[
    // // 사용할 앱의 JavaScript 키를 설정해 주세요.
    Kakao.init('cd6568a772de5b0d11cf334911557f3a');
    // // 카카오링크 버튼을 생성합니다. 처음 한번만 호출하면 됩니다.
    function sendLink() {
      Kakao.Link.sendDefault({
        objectType: 'feed',
        content: {
          title: performInfo.name,
          description: "#" + performInfo.location + " #" + formatDate(performInfo.entryDate, 2),
          /* imageUrl: 'http://t3.java100.com:9999/download/1519276961521_0.jpg', */
          imageUrl: 'http://allnewframe.com/web/product/big/201605/735_shop1_940873.jpg',
          link: {
            mobileWebUrl: 'http://t3.java100.com:9999/performance/list.html',
            webUrl: 'http://t3.java100.com:9999/performance/list.html'
          }
        },
        social: {
          likeCount: 286,
          commentCount: 45,
          sharedCount: 845
        },
        buttons: [
          {
            title: '웹으로 보기',
            link: {
              mobileWebUrl: 'http://t3.java100.com:9999/performance/list.html',
              webUrl: 'http://t3.java100.com:9999/performance/list.html'
            }
          },
          {
            title: '앱으로 보기',
            link: {
              mobileWebUrl: 'http://t3.java100.com:9999/performance/list.html',
              webUrl: 'http://t3.java100.com:9999/performance/list.html'
            }
          }
        ]
      });
    }
  //]]>
</script>




<script>
function initMap() {
    map = new google.maps.Map(document.getElementById("map_canvas"), {
         center: { lat: 37.497912049682526, lng: 127.0276288757841 },
         scrollwheel: true,
         zoom: 17
    });
  
    //var infoWindow = new google.maps.InfoWindow({map: map});
    marker = new google.maps.Marker({
        position: map.center,
        map: map,
        title: "공연위치",
        //draggable: true,
        animation: google.maps.Animation.DROP
    });

    map.setCenter(marker.position);
}

</script>

<script type="text/javascript">

var map, marker;

var performInfo = {},
    pagearr,
    noItem = $('#no'),
    mediatable = $('#media-table');
    detailtable = $('#detail-table');
    sponsorBtn = $('#sponsorBtn'),
    updateBtn = $('#updateBtn'),
    deleteBtn = $('#deleteBtn'),
    jjimBtn = $('#jjimBtn'),
    rippleBtn = $('#rippleBtn'),
    ratingBtn = $('#ratingBtn'),
    jjimItem = $('#jjim'),
    ratingItem = $('#rating'),
    rippleItem = $('#ripple'),
    infolist = $('#infolist > tbody'),
    ripplelist = $('#ripplelist > tbody');

$(document.body).on('login', (event, obj) => {
    console.log('로그인 정보 가져오기:', loginUser.type);
    load();
});

$('header').load('../header.html');

$('footer').load('../footer.html');


var index = location.href.indexOf('?');

//$(document.body).on('login', (event, obj) => {

function load() {
    $('.my-hidden').css('display', 'none');
    if (index != -1) { // 기존 데이터를 조회할 경우,
        var qs = location.href.substr(index + 1);
        pagearr = qs.split('=');
        //$('h1').html("공연 정보");
        $('.my-new').css('display', 'none');
        $(() => {
            
            // 공연정보
            $.ajax('../json/performance/' + pagearr[1], {
                dataType: 'json',
                async : false,
                success: (result) => {
                    
                    // 다른 함수에서 사용
                    performInfo = result.data;
                    console.log(performInfo);
                    
                    var filename;
                    for(var media of performInfo.medias) {
                        if (media.filename == null) {
                            filename = 'no_img.jpg';
                        } else {
                            filename = media.filename;
                        }
                    };
                    
                    for (var data of performInfo.medias) {
                        if (data.filename != null) {
                            //mediasItem.append("<img src='../download/" + data.filename + "' height=100>");
                            //mediasItem.append("<a href='/download/" + data.filename + "'>" + data.filename + "</a><br>");
                        }
                    };
                    
                    if (performInfo.artist.artistMember == null) performInfo.artist.artistMember = '없음';
                    

                    noItem.val(performInfo.no);
                    
                    //imagetable
                    mediatable.html("");
                    $('<tr>').html(
                        "<img src='../download/" + filename + "'style='width:350px'>"
                        //"<img src='../download/no_img.jpg' style='width:300px'>" +
                    ).appendTo(mediatable);

                    //detailtable
                    detailtable.html("");
                    $('<tr>').html(
                            "<td id='detail-td1'>" + "공연명" + "</td>" +
                            "<td id='detail-td2'>" + performInfo.name + "</td>"
                    ).appendTo(detailtable);
                    
                    $('<tr>').html(
                            "<td id='detail-td1'>" + "공연 장르" + "</td>" +
                            "<td id='detail-td2'>" + performInfo.genre + "</td>"
                    ).appendTo(detailtable);
                    
                    $('<tr>').html(
                            "<td id='detail-td1'>" + "공연 날짜" + "</td>" +
                            "<td id='detail-td2'>" + formatDate(performInfo.entryDate, 3) + "</td>"
                    ).appendTo(detailtable);
                    
                    $('<tr>').html(
                            "<td id='detail-td1'>" + "공연 장소" + "</td>" +
                            "<td id='detail-td2'>" + performInfo.location + "</td>"
                    ).appendTo(detailtable);
                    
                    /* $('<tr>').html(
                            "<td id='detail-td1'>" + "공연 내용" + "</td>" +
                            "<td id='detail-td2'>" + performInfo.detailDesc + "</td>"
                    ).appendTo(detailtable); */
                    

                    
                    
                    $('.tab-one').append(
                        //"<div class='w3-third' style='width:400px'>" +
                        //"<img src='../download/" + performInfo.writer.photo + "' width=200><br>" +
                        //"<img src='../download/no_img.jpg' style='width:300px'>" +
                        //"</div>" +
                        //"<div class='w3-third' style='border: 2px solid red;'>" + 
                        //"<div id='map_canvas' style='width:400px; height:350px; border: 2px solid blue;'></div>" +
                        //"</div>" +
                        "<div class='w3-twothird'>" +
                        "<table id='detail-table' class='w3-table w3-striped w3-white'>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "공연명" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + performInfo.name  + "</td>" +
                        "</tr>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "공연 장르" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + performInfo.genre + "</td>" +
                        "</tr>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "공연 내용" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + performInfo.detailDesc + "</td>" +
                        "</tr>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "특이 사항" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + performInfo.specialDesc + "</td>" +
                        "</tr>" +
                        "</table>" +
                        "</div>"
                    );
                    
                    // 구글맵
                    var maplat, maplng, maplatlng
                    if ((performInfo.mapLatitude == 0) && (performInfo.mapLongitude == 0)) {
                        maplat = 37.497912049682526;
                        maplng = 127.0276288757841;
                    } else {
                        maplat = performInfo.mapLatitude;
                        maplng = performInfo.mapLongitude;
                    }

                    maplatlng = new google.maps.LatLng(maplat, maplng); 
                    map.setCenter(maplatlng);
                    marker.setPosition(maplatlng);
                    
                    $('.tab-two').append(
                        "<div class='w3-third' style='width:400px'>" +
                        "<img src='../download/" + performInfo.writer.photo + "' width=300><br>" +
                        "</div>" +
                        "<div class='w3-twothird'>" +
                        "<table id='detail-table' class='w3-table w3-striped w3-white'>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "아티스트명" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + performInfo.artist.artistName + "</td>" +
                        "</tr>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "구성원" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + performInfo.artist.artistMember + "</td>" +
                        "</tr>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "프로필" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + performInfo.artist.profile + "</td>" +
                        "</tr>" +
                        "<tr>" +
                        "<td id='detail-td1' style='background:white'>" + "결성일" + "</td>" +
                        "<td id='detail-td2' style='background:white'>" + formatDate(performInfo.artist.joinDate, 2) + "</td>" +
                        "</tr>" +
                        "<td>" +
                        "<button id='sponsorBtn' type='button' class='btn btn-primary btn-sm my-view'>후원하기</button>" +
                        "</td>" +
                        "</table>" +
                        "</div>"
                    );
                    
                    $('.tab-three').append(
                        "<h1'>" + "공연 사진" + "</h1><br>" +
                        "<img src='../download/" + filename + "' width=300>"
                        //"<img src='../download/no_img.jpg' style='width:300px'>"
                    );
                    
                    $('.tab-four').append(
                        //"<h1'>" + "공연 내용" + "</h1>" +
                        //"<p>" + performInfo.detailDesc +"</p><hr>" +
                        //"<h1'>" + "특이 사항" + "</h1>" +
                        //"<p>" + performInfo.specialDesc
                    );
                    
                    // 찜
                    $.ajax('../json/performance/viewjjim', {
                        data: {
                            //performanceNo: noItem.val()
                            performanceNo: pagearr[1]
                        },
                        dataType: 'json',
                        method: 'POST',
                        success: (result) => {
                            if (result.jjimFlag == '1') {
                                jjimBtn.text("찜");
                            } else {
                                jjimBtn.text("찜하기");
                            }
                        },
                        error: () => {
                            window.alert('viewjjim 서버 실행 오류!');
                        }
                    });
                    
                    // 평점
                    $.ajax('../json/performance/checkrating', {
                        data: {
                            //performanceNo: noItem.val()
                            performanceNo: pagearr[1]
                        },
                        dataType: 'json',
                        method: 'POST',
                        success: (result) => {
                            if (result.rating == 1) {
                                $('.rating').css('display', 'none');
                            }
                        },
                        error: () => {
                            window.alert('checkrating 서버 실행 오류!');
                        }
                    });
                    
                    // 리플
                    $.ajax('../json/performance/viewripple', {
                        data: {
                            //performanceNo: noItem.val(),performInfo.no
                            performanceNo: pagearr[1]
                        },
                        dataType: 'json',
                        method: 'POST',
                        success: (result) => {
                            
                            ripplelist.html("");
                            
                            for (var data of result.list) {
                                $('<tr>').html(
                                    "<td>" + 
                                        "<img class='imglist' src='../download/" + data.writer.photo + "' height=30px>" + "</td>" +
                                    "<td>"  + data.writer.nickName + "<span>"+ formatDate(data.regDate, 1) + "</spna>" +
                                        "<div>" + data.ripple +
                                    "</td>"
                                ).appendTo(ripplelist);
                            }
                        },
                        error: () => {
                            window.alert('viewripple 서버 실행 오류!');
                        }
                    });
                    
                    
                    
                    if (loginUser.no != result.data.writer.no ) {
                        $('.my-view').css('display', 'none');
                    }
                    $('#formData').css('display', 'none');

                },
                error: () => {
                    window.alert('view 서버 실행 오류!');
                }
            });
        });
        
        
    } /* else { // 신규 데이터 입력일 경우,
        $('h1').html("공연 등록");
        $('#general-view').css('display', 'none');
        $('.my-view').css('display', 'none');
        $('.my-view').css('display', 'none');
        $('.jjim').css('display', 'none');
        $('.ripple').css('display', 'none');
        $('.ripple').css('display', 'none');
    } 
    # form */
} 



/* 
addBtn.click(() => {

    var formData = new FormData($("#formData")[0]);
    
    // 공연정보 전송
    $.ajax({
        url: '../json/performance/add',
        data: formData,
        dataType: 'json',
        processData: false,
        contentType: false,
        //cache: false,
        method: 'POST',
        success: function(result) {
            location.href = "list.html";
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
});
# form */

/* sponsorBtn.click(() => { */
$(document).on("click","#sponsorBtn",function() {
    location.href = "../sponsor/form.html?no="+ performInfo.no;
});


updateBtn.click(() => {
    if (loginUser.type == '아티스트') {
        location.href = "form.html?no="+ performInfo.no;
    } else {
        return
    }
    
    /* if (updateBtn.text() == "공연 수정") {

        $('h1').html("공연 수정");
        //$('#artist-view').css('display', '');
        $('#general-view').css('display', 'none');
        $('#formData').css('display', 'inline');
        //$('#formList').css('display', 'none');
        //$('#formjjim').css('display', 'none');
        //$('#comment').css('display', 'none');
        //$('#ripplelist').css('display', 'none');
        //$('#deleteBtn').css('display', 'none');
        updateBtn.text("수정 저장"); 
        deleteBtn.text("수정 취소"); 
    } else {
        var formData = new FormData($("#formData")[0]);
    
        $.ajax({
           url: '../json/performance/update',
           data: formData,
           dataType: 'json',
           processData: false,
           contentType: false,
           //cache: false,
           method: 'POST',
           success: function(result) {
               location.href = "list.html";
           },
           error: () => {
               window.alert('서버 실행 오류!');
           }
        });
    
    } */
});


$('#jjimBtn').click(function() {
    var flag;
    
    /* if($(this).is(':checked')) {
        flag = '1';
    } else {
        flag = '0';
    } */
    
    if (jjimBtn.text() == "찜하기") {
        flag = "1";
    } else {
        flag = "0";
    }
    
    $.ajax('../json/performance/jjim', {
        data: {
            performanceNo: noItem.val(),
            memberNo: loginUser.no,
            jjimFlag: flag
        },
        dataType: 'json',
        success: (result) => {
            if (jjimBtn.text() == "찜하기") {
                jjimBtn.text("찜");
            } else {
                jjimBtn.text("찜하기");
            }
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
});

ratingBtn.click(() => {
    $.ajax('../json/performance/addrating', {
        data: {
            performanceNo: noItem.val(),
            memberNo: loginUser.no,
            score: ratingItem.val()
        },
        dataType: 'json',
        method: 'POST',
        success: (result) => {
            $('.rating').css('display', 'none');
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
});

rippleBtn.click(() => {
    
    console.log("ripple click");
    $.ajax('../json/performance/addripple', {
        data: {
            performanceNo: noItem.val(),
            memberNo: loginUser.no,
            ripple: rippleItem.val()
        },
        dataType: 'json',
        method: 'POST',
        success: (result) => {
            
            // 리플 다시 불러오기
            $.ajax('../json/performance/viewripple', {
                data: {
                    performanceNo: noItem.val(),
                    //memberNo: loginUser.no,
                },
                dataType: 'json',
                method: 'POST',
                success: (result) => {
                    
                    rippleItem.val('');
                    ripplelist.html("");
                    console.log("리플");
                    
                    for (var data of result.list) {
                        
                        $('<tr>').
                            html(
                                "<td>" + 
                                    "<img src='../download/" + data.writer.photo + "' height=50>" + "</td>" +
                                "<td>"  + data.writer.nickName + "<span>"+ formatDate(data.regDate, 3) + "</spna>" +
                                    "<div>" + data.ripple +
                                "</td>"
                            ).appendTo(ripplelist);
                    }
                },
                error: () => {
                    window.alert('viewripple 서버 실행 오류!');
                }
            });
        },
        error: () => {
            window.alert('addripple 서버 실행 오류!');
        }
    });
});


function formatDate(jason, typedt) {
    var jasondate = new Date(jason);
    var strval;
    
    if (typedt == 0) {
        strval = jasondate.getFullYear() + '-' + 
                 pad((jasondate.getMonth() + 1), 2) + '-' + 
                 pad(jasondate.getDate(), 2);
    } else if (typedt == 1) {
        strval = jasondate.getFullYear() + '-' +
                 pad((jasondate.getMonth() + 1), 2) + '-' +
                 pad(jasondate.getDate(), 2) + ' ' +
                 pad(jasondate.getHours(), 2) + ':' +
                 pad(jasondate.getMinutes(), 2);
    } else if (typedt == 2) {
        strval = jasondate.getFullYear() + '년' + 
                 pad((jasondate.getMonth() + 1), 2) + '월' + 
                 pad(jasondate.getDate(), 2) + '일';
    } else if (typedt == 3) {
        if (jasondate.getMinutes() == 0) {
            strval = jasondate.getFullYear() + '년' + 
                     pad((jasondate.getMonth() + 1), 2) + '월' + 
                     pad(jasondate.getDate(), 2) + "일 " +
                     pad(jasondate.getHours(), 2) + '시';
        } else {
            strval = jasondate.getFullYear() + '년' + 
                     pad((jasondate.getMonth() + 1), 2) + '월' + 
                     pad(jasondate.getDate(), 2) + "일 " +
                     pad(jasondate.getHours(), 2) + '시'+
                     pad(jasondate.getMinutes(), 2) + '분';
        }
    } else if (typedt == 4) {
        if (jasondate.getMinutes() == 0) {
            strval = jasondate.getFullYear() + '년' + 
                     pad((jasondate.getMonth() + 1), 2) + '월' + 
                     pad(jasondate.getDate(), 2) + "일<br/>" +
                     pad(jasondate.getHours(), 2) + '시';
        } else {
            strval = jasondate.getFullYear() + '년' + 
                     pad((jasondate.getMonth() + 1), 2) + '월' + 
                     pad(jasondate.getDate(), 2) + "일<br/>" +
                     pad(jasondate.getHours(), 2) + '시' +
                     pad(jasondate.getMinutes(), 2) + '분';
        }
    } else {
        strval = jasondate.getFullYear() + '-' +
                 pad((jasondate.getMonth() + 1), 2) + '-' +
                 pad(jasondate.getDate(), 2) + ' ' +
                 pad(jasondate.getHours(), 2) + ':' +
                 pad(jasondate.getMinutes(), 2);
    }
    
    return strval;
}


function pad(n, width) {
    n = n + '';
    return n.length >= width ? n : new Array(width - n.length + 1).join('0') + n;
}

</script>


</body>
</html>














